---
import { getCollection } from "astro:content";

const posts = (await getCollection("posts")).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<section id='work' class='blogs section'>
    <div class='section-header'>
        <h2 class='section-title font-mono text-muted'>Selected Writing</h2>
    </div>

    <div class='blog-list' id='blog-list'>
        {
            posts.map((post, index) => (
                <article class='blog-item'>
                    <a
                        href={`/blog/${post.slug}`}
                        class='blog-link'
                        data-image={
                            post.data.heroImage || "/project_thumbnail_1.png"
                        }>
                        <span class='index font-mono text-muted'>
                            {(index + 1).toString().padStart(2, "0")}
                        </span>
                        <h3 class='title'>{post.data.title}</h3>
                        <span class='category font-mono text-muted'>
                            {post.data.tags[0] || "General"}
                        </span>
                        <span class='date font-mono text-muted'>
                            {post.data.pubDate.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })}
                        </span>
                    </a>
                </article>
            ))
        }
    </div>

    <div class='blog-preview-image'>
        <div class='preview-inner'>
            <img src='' alt='Blog Preview' id='preview-img' />
        </div>
    </div>
</section>

<script>
    import gsap from "gsap";

    document.addEventListener("astro:page-load", () => {
        const blogList = document.getElementById("blog-list");
        const previewContainer = document.querySelector(
            ".blog-preview-image",
        ) as HTMLElement;
        const previewImg = document.getElementById(
            "preview-img",
        ) as HTMLImageElement;
        const blogLinks = document.querySelectorAll(".blog-link");

        if (blogList && previewContainer && previewImg) {
            // Move the preview container with mouse
            document.addEventListener("mousemove", (e) => {
                const x = e.clientX;
                const y = e.clientY;

                gsap.to(previewContainer, {
                    x: x,
                    y: y,
                    duration: 0.8,
                    ease: "power3.out",
                });
            });

            blogLinks.forEach((link) => {
                link.addEventListener("mouseenter", () => {
                    const imageUrl = link.getAttribute("data-image");
                    if (imageUrl) {
                        previewImg.src = imageUrl;

                        gsap.to(previewContainer, {
                            scale: 1,
                            opacity: 1,
                            duration: 0.4,
                            ease: "power2.out",
                        });
                    }
                });

                link.addEventListener("mouseleave", () => {
                    gsap.to(previewContainer, {
                        scale: 0,
                        opacity: 0,
                        duration: 0.4,
                        ease: "power2.out",
                    });
                });
            });
        }
    });
</script>

<style>
    .section-header {
        margin-bottom: var(--space-lg);
        border-bottom: 1px solid var(--color-border);
        padding-bottom: var(--space-sm);
    }

    .section-title {
        font-size: var(--text-sm);
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }

    .blog-list {
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 10;
    }

    .blog-item {
        border-bottom: 1px solid var(--color-border);
    }

    .blog-link {
        display: grid;
        grid-template-columns: auto 1fr auto auto;
        gap: var(--space-md);
        align-items: baseline;
        padding: var(--space-lg) var(--space-sm);
        text-decoration: none;
        color: inherit;
        transition: all 0.4s var(--ease-out-expo);
        border-radius: var(--radius-sm);
    }

    .blog-list:hover .blog-link:not(:hover) {
        opacity: 0.3;
        filter: blur(2px);
    }

    .blog-link:hover {
        background: rgba(255, 255, 255, 0.03);
        padding-left: var(--space-md);
        padding-right: var(--space-md);
        transform: scale(1.02);
    }

    .index {
        font-size: var(--text-sm);
    }

    .title {
        font-size: var(--text-xl);
        font-weight: 400;
    }

    .category,
    .date {
        font-size: var(--text-sm);
        display: none;
    }

    /* Floating Preview Image */
    .blog-preview-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 400px;
        height: 250px;
        pointer-events: none;
        z-index: 5;
        opacity: 0;
        transform: translate(-50%, -50%) scale(0);
        transform-origin: center;
        overflow: hidden;
        border-radius: var(--radius-sm);
    }

    .preview-inner {
        width: 100%;
        height: 100%;
        overflow: hidden;
        border-radius: var(--radius-sm);
    }

    #preview-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    @media (min-width: 768px) {
        .category,
        .date {
            display: block;
        }

        .title {
            font-size: var(--text-2xl);
        }
    }
</style>
