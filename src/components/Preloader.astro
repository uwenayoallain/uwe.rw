<div class="preloader" id="preloader">
    <div class="loader-text">
        <span class="word">Crafting</span>
        <span class="word">Digital</span>
        <span class="word">Experiences</span>
    </div>
</div>

<script is:inline>
    (function () {
        if (sessionStorage.getItem("preloaderShown")) {
            document.getElementById("preloader").style.display = "none";
        }
    })();
</script>

<script>
    import gsap from "gsap";

    async function initPreloader() {
        const preloader = document.getElementById("preloader");
        if (!preloader) return;

        if (sessionStorage.getItem("preloaderShown")) {
            preloader.style.display = "none";
            return;
        }

        sessionStorage.setItem("preloaderShown", "true");
        document.body.style.overflow = "hidden";

        // Wait for fonts to load before starting animation
        await document.fonts.ready;

        const words = preloader.querySelectorAll(".word");

        // Initial state
        gsap.set(words, {
            autoAlpha: 0,
            y: 50,
            filter: "blur(10px)",
        });

        const tl = gsap.timeline({
            onComplete: () => {
                preloader.style.display = "none";
                document.body.style.overflow = "";
            },
        });

        tl.to(words, {
            autoAlpha: 1,
            y: 0,
            filter: "blur(0px)",
            duration: 1,
            stagger: 0.15,
            ease: "power4.out",
        })
            .to(words, {
                autoAlpha: 0,
                y: -50,
                filter: "blur(10px)",
                duration: 0.8,
                stagger: 0.1,
                ease: "power3.in",
                delay: 0.8,
            })
            .to(
                preloader,
                {
                    yPercent: -100,
                    duration: 0.8,
                    ease: "power4.inOut",
                },
                "-=0.2",
            );
    }

    document.addEventListener("astro:page-load", initPreloader);
</script>

<style>
    .preloader {
        position: fixed;
        inset: 0;
        background-color: var(--color-bg);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .loader-text {
        font-family: var(--font-mono);
        font-size: clamp(1.2rem, 3vw, 2rem);
        color: var(--color-brand-gold);
        font-weight: 600;
        display: flex;
        gap: 0.75rem;
    }

    .word {
        display: inline-block;
        opacity: 0;
    }
</style>
